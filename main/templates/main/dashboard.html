{% extends "main/base.html" %}
{% load static %}
{% load widget_tweaks %}

{% block head %}
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <script src="{% static 'js/index.js' %}"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;700&display=swap" rel="stylesheet">
{% endblock %}
{% block content %}
<div class="dashboard-container">
    <!-- Show form errors if any -->


    <!-- Blog Upload Section -->
    <div class="card">
        <h2 class="card-title">üìù Add New Blog Post</h2>
        {% if form.errors %}
  <div style="color: red; margin-bottom: 10px;">
      {{ form.non_field_errors }}
      {% for field in form %}
          {% for error in field.errors %}
              <p>{{ field.label }}: {{ error }}</p>
          {% endfor %}
      {% endfor %}
  </div>
{% endif %}
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="form-group">
                <label>Title</label>
                {{ form.title|add_class:"input-field" }}
            </div>
            <div class="form-group">
                <label>Slug</label>
                {{ form.slug|add_class:"input-field" }}
            </div>
            <div class="form-group">
                <label>Content</label>
                {{ form.content|add_class:"input-field" }}
            </div>
            <div class="form-group">
                <label>Image</label>
                {{ form.image|add_class:"input-field" }}
            </div>
            <div class="form-group">
                <label>Link</label>
                {{ form.link|add_class:"input-field" }}
            </div>
            <button type="submit" class="btn">Publish</button>
        </form>
    </div>

    <!-- Uploaded Blog Posts Section -->
    <div class="card">
        <h2 class="card-title">üìë Published Blog Posts</h2>
        {% if posts %}
            <ul class="file-list">
                {% for post in posts %}
                    <li class="file-item">
                        <div>
                            <strong>{{ post.title }}</strong><br>
                            <small>Published: {{ post.created_at|date:"M d, Y H:i" }}</small>
                        </div>

                        <!-- View and Delete buttons -->
                        <div style="display: flex; gap: 10px;">
                            <a href="{% url 'post_detail' post.pk %}" class="btn download-btn">View</a>

                            <form method="post" onsubmit="return confirm('Are you sure you want to delete this post?');">
                                {% csrf_token %}
                                <input type="hidden" name="delete_post_id" value="{{ post.id }}">
                                <button type="submit" class="btn" style="background-color: #dc3545;">Delete</button>
                            </form>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="empty-text">No blog posts yet.</p>
        {% endif %}
    </div>
</div>
{% endblock %}
